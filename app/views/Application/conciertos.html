<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Conciertos</title>
    <link rel="stylesheet" href="@{'/public/stylesheets/main.css'}">
</head>

<body>

<header class="header">
    <h1>Concertify</h1>

    <div class="nav">
        <div class="nav-left">
            <a href="/">Inicio</a>
        </div>

        <div class="nav-right">

            #{if session.get("isAdmin") != null}
            <a href="/admin/artistas">Gestion Artistas</a>
            <a href="/admin/salas">Gestion Salas</a>
            <a href="/admin/conciertos">Gestion Conciertos</a>
            <a href="/admin/logout">Cerrar Sesión Admin</a>
            #{/if}

            #{elseif session.get("username") != null}
            <span>Hola ${session.get("username")} </span>
            <a href="/logout">Cerrar Sesión</a>
            #{/elseif}

            #{else}
            <a href="/login">Iniciar Sesión</a>
            <a href="/registre">Registrarse</a>
            #{/else}

        </div>

    </div>
</header>

<main class="page">
    <div class="section-title">
        <h2>Conciertos</h2>
    </div>

    <div class="cards-grid">
        #{list items:conciertos, as:'c'}
        <div class="card">
            <div class="card-img">
                <div class="pill ${c.estado}">
                    ${c.estado}
                </div>
            </div>

            <div class="card-body">
                <div class="card-title">${c.artista.nombre_artistico}</div>
                <div class="card-subtitle">${c.sala.nombre} · ${c.sala.direccion}</div>

                <div class="card-meta">
                    Fecha: <strong>${c.fecha}</strong><br>
                    Aforo: ${c.sala.capacidad}
                </div>

                <div class="card-actions">
                    <button type="button"
                            class="btn btn-soft js-concierto-details"
                            data-fecha="${c.fecha}"
                            data-estado="${c.estado}"
                            data-artista="${c.artista != null ? c.artista.nombre_artistico : '-'}"
                            data-sala="${c.sala != null ? c.sala.nombre : '-'}"
                            data-direccion="${c.sala != null ? c.sala.direccion : '-'}">
                        Detalles
                    </button>
                    <button type="button"
                            class="btn btn-primary js-sala-details"
                            data-nombre="${c.sala != null ? c.sala.nombre : '-'}"
                            data-direccion="${c.sala != null ? c.sala.direccion : '-'}"
                            data-capacidad="${c.sala != null ? c.sala.capacidad : '-'}">
                        Sala
                    </button>
                </div>
            </div>
        </div>
        #{/list}
    </div>
</main>

<footer class="footer">
    © 2025 Concertify
</footer>

<div class="modal-overlay" id="conciertoDetailsModal">
    <div class="modal">
        <div class="modal-header">
            <h3>Detalles del concierto</h3>
            <button type="button" class="modal-close" id="closeConciertoDetails">×</button>
        </div>

        <div class="modal-content">
            <p><strong>Fecha:</strong> <span id="det_concierto_fecha"></span></p>
            <p><strong>Estado:</strong> <span id="det_concierto_estado"></span></p>
            <p><strong>Artista:</strong> <span id="det_concierto_artista"></span></p>
            <p><strong>Sala:</strong> <span id="det_concierto_sala"></span></p>
            <p><strong>Dirección / Ciudad:</strong> <span id="det_concierto_direccion"></span></p>
        </div>

        <div style="margin-top: 14px;">
            <button type="button" class="btn btn-soft" id="okConciertoDetails">Cerrar</button>
        </div>
    </div>
</div>

<script>
    (function () {
      const overlay = document.getElementById('conciertoDetailsModal');
      const closeBtn = document.getElementById('closeConciertoDetails');
      const okBtn = document.getElementById('okConciertoDetails');

      const fEl = document.getElementById('det_concierto_fecha');
      const eEl = document.getElementById('det_concierto_estado');
      const aEl = document.getElementById('det_concierto_artista');
      const sEl = document.getElementById('det_concierto_sala');
      const dEl = document.getElementById('det_concierto_direccion');

      function openModal() { overlay.classList.add('is-open'); }
      function closeModal() { overlay.classList.remove('is-open'); }

      document.querySelectorAll('.js-concierto-details').forEach(btn => {
        btn.addEventListener('click', () => {
          fEl.textContent = btn.dataset.fecha || '-';
          eEl.textContent = btn.dataset.estado || '-';
          aEl.textContent = btn.dataset.artista || '-';
          sEl.textContent = btn.dataset.sala || '-';
          dEl.textContent = btn.dataset.direccion || '-';
          openModal();
        });
      });

      closeBtn.addEventListener('click', closeModal);
      okBtn.addEventListener('click', closeModal);

      overlay.addEventListener('click', (ev) => {
        if (ev.target === overlay) closeModal();
      });
    })();
</script>

<div class="modal-overlay" id="salaDetailsModal">
    <div class="modal">
        <div class="modal-header">
            <h3>Detalles de la sala</h3>
            <button type="button" class="modal-close" id="closeSalaDetails">×</button>
        </div>

        <div class="modal-content">
            <p><strong>Nombre:</strong> <span id="det_sala_nombre"></span></p>
            <p><strong>Dirección / Ciudad:</strong> <span id="det_sala_direccion"></span></p>
            <p><strong>Capacidad:</strong> <span id="det_sala_capacidad"></span></p>
        </div>

        <div style="margin-top: 14px;">
            <button type="button" class="btn btn-soft" id="okSalaDetails">Cerrar</button>
        </div>
    </div>
</div>

<script>
    (function () {
      const overlay = document.getElementById('salaDetailsModal');
      const closeBtn = document.getElementById('closeSalaDetails');
      const okBtn = document.getElementById('okSalaDetails');

      const nEl = document.getElementById('det_sala_nombre');
      const dEl = document.getElementById('det_sala_direccion');
      const cEl = document.getElementById('det_sala_capacidad');

      function openModal() { overlay.classList.add('is-open'); }
      function closeModal() { overlay.classList.remove('is-open'); }

      document.querySelectorAll('.js-sala-details').forEach(btn => {
        btn.addEventListener('click', () => {
          nEl.textContent = btn.dataset.nombre || '-';
          dEl.textContent = btn.dataset.direccion || '-';
          cEl.textContent = btn.dataset.capacidad || '-';
          openModal();
        });
      });

      closeBtn.addEventListener('click', closeModal);
      okBtn.addEventListener('click', closeModal);

      overlay.addEventListener('click', (ev) => {
        if (ev.target === overlay) closeModal();
      });
    })();
</script>
</body>
</html>
